const aa={en:"English",ja:"日本語"},ba={bmp:"image/bmp",gif:"image/gif",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png"},ca={avi:"video/x-msvideo",mp4:"video/mp4",mpeg:"video/mpeg"};function p(a){var c=null;if(a)if("string"==typeof a)switch(a.charAt(0)){case "#":c=document.getElementById(a.slice(1))}else a instanceof Event?c=a.srcElement||a.target:c=a;else c=window.event.srcElement||window.event.target;return c}function r(a,c){return(a=a.parentElement)?a.tagName==c?a:r(a,c):null}function da(){var a=document.getElementById("divPwd");return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)}function ea(a){if(a=p(a))a.style.display="none"}
function t(a){a=p(a);if(a){var c=a.getElementsByTagName("tbody")[0];return{ca:a,G:c}}return null}function fa(a,c){if((a=a.nextElementSibling)&&c)switch(c.charAt(0)){case "#":for(c=c.slice(1);a&&a.id!=c;)a=a.nextElementSibling;break;default:for(c=c.toUpperCase();a&&a.tagName!=c;)a=a.nextElementSibling}return a}
function u(a,c,b){if((a=b?a.lastElementChild:a.previousElementSibling)&&c)switch(c.charAt(0)){case "#":for(c=c.slice(1);a&&a.id!=c;)a=a.previousElementSibling;break;default:for(c=c.toUpperCase();a&&a.tagName!=c;)a=a.previousElementSibling}return a}function ha(a,c,b){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,c);else if(b)b.download=c,b.href=window.URL.createObjectURL(a),b.click();else throw Error("Element for download is not specified.");}
function ia(a){if(!a)return null;var c=a.charAt(0);if("?"==c||"#"==c)a=a.substring(1);var b={};a.split("&").forEach(function(d){var e=d.indexOf("=");0>e?b[decodeURIComponent(d)]="":b[decodeURIComponent(d.substring(0,e))]=decodeURIComponent(d.substring(e+1))});return b}function ja(){var a=ia(window.location.search),c=ia(window.location.hash);c&&(a=a?Object.assign(a,c):c);return a}
function v(a,c){var b=[],d;for(d in a)c?b.push(d.concat("=").concat(a[d])):b.push(encodeURIComponent(d).concat("=").concat(encodeURIComponent(a[d])));return 0<b.length?"?".concat(b.join("&")):""}
function ka(a){if(a)if(1024>a)var c="B";else 1048576>a?(c="KB",a=Math.round(a/102.4)/10):1073741824>a?(c="MB",a=Math.round(a/104857.6)/10):(c="GB",a=Math.round(a/1.073741824E8)/10);else c="B",a=0;var b=a.toString();a=b.indexOf(".");var d=b.split(""),e=[];0<=a?e.push(b.slice(a)):a=d.length;for(b=0;0<a;)3==b++&&(e.unshift(","),b=1),e.unshift(d[--a]);return e.join("").concat(c)}
function la(a){if(!a)return 0;var c=a.indexOf("-");if(0>c)return 0;c++;var b=a.indexOf("/",c);return b<=c?0:parseInt(a.slice(c,b),10)};function x(a){var c=CryptoJS.MD5(a);a=CryptoJS.kdf.OpenSSL.execute(a,8,4,c);a.iv.clamp();a.key.clamp();return a}
function y(a,c,b){var d=b;"string"==typeof b&&(d=x(b));if(!(d&&d.iv&&d.key))throw Error("Need iv and key. They can be generated by CryptoJS.kdf.OpenSSL.execute from password and salt.");b={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7};Object.assign(b,d);a=a?CryptoJS.algo.AES.createEncryptor(b.key,b):CryptoJS.algo.AES.createDecryptor(b.key,b);c=a.process(c);c.concat(a.finalize());c.clamp();return c}
function ma(a){var c=Array(a.sigBytes);a=a.words;for(var b=0,d=0;d<a.length;d++){for(var e=a[d],f=b+4-1;f>=b;f--)f<c.length&&(c[f]=e&255),e>>=8;b+=4;if(b>=c.length)break}return c}
function na(){this.h=0;this.g=null;this.l=function(a,c){this.h=a;c&&c()};this.write=function(a,c){Array.isArray(a)?this.g=this.g?this.g.concat(a):a.concat():(this.g||(this.g=[]),this.g.push(a));c&&c()};this.cancel=function(a){a&&a(!1,!0)};this.u=function(){if(this.g&&0<this.g.length&&(this.g[0]instanceof ArrayBuffer||this.g[0]instanceof Uint8Array)){for(var a=0,c=0;c<this.g.length;c++)a+=this.g[c].byteLength;a=new Uint8Array(a);var b=0;for(c=0;c<this.g.length;++c){var d=this.g[c];d instanceof ArrayBuffer&&
(d=new Uint8Array(d));a.set(d,b);b+=d.byteLength}return a}return this.g};this.A=function(){var a=this.u();a instanceof Uint8Array||(a=new Uint8Array(a));return new Blob([a],{type:"application/octet-binary"})};this.download=function(a){var c=this.A();ha(c,a,null)};this.B=function(){return this.h}}
function oa(a){this.o=null;if(a._blob)if(a._blob instanceof Blob)this.o=a._blob;else throw Error("blob is not a Blob.");else throw Error("blob must be specified.");this.B=1600;a.U&&(this.B=a.U);this.g=0;this.u=this.l=null;this.J=function(c,b){if(c){if(c>=this.h())throw Error("offset can not be bigger than input size.");this.g=c}this.l=new FileReader;this.l.onload=function(d){d=d.target.result;this.u&&this.u(d,this)}.bind(this);b&&b()};this.A=function(){return this.g};this.h=function(){return this.o.size};
this.C=function(){return this.g>=this.h()};this.i=function(c){if(1!=this.l.readyState){var b=this.g;this.g=c?this.g+c:this.g+this.B;this.l.readAsArrayBuffer(this.o.slice(b,this.g))}};this.P=function(){this.o=this.l=null}}
function z(a,c){if(!a.oa)if(this.getSuperClass&&"Readable"==this.getSuperClass().name)this.super(c),this.h=1,c&&c.objectMode&&(this.M=!0);else throw Error("writer must be specified in no stream mode.");this.o=this.H=null;this.C=!0;this.g=null;this.l=a.oa;this.iv=this.key=null;this.i=0;this.A=null;this.B=this.u=0;this.speed="0B/s";a.ma&&(this.C=!1);if(a.ga)this.g=a.ga;else throw Error("reader must be specified.");if(a.Z)c=null,c="string"==typeof a.Z?x(a.Z):a.Z,this.key=c.key,this.iv=c.iv;else throw Error("keycfg must be specified.");
this.start=function(b){if(b){if(this.C)throw Error("Can NOT set offset for encryption.");this.i=b;b-=b%16+16;0>b&&(b=0)}this.g.u=this.J.bind(this);this.g.J(b,function(){var d=16*Math.ceil((this.g.h()+1)/16);this.h||!this.l?this.I():this.l.l(d,this.I.bind(this))}.bind(this))};this.L=function(){Date.now()>this.u&&(this.speed=ka(1E3*(this.g.A()-this.B)/(Date.now()-this.u+1E3))+"/s",this.u=Date.now()+1E3,this.B=this.g.A());return this.speed};this._read=function(b){1==this.h?this.h=2:3==this.h&&(this.g.C()?
this.push(null):this.g.i(b))};this.push=function(b){return this.readable?(b&&!this.M?this.superCall("push",new Uint8Array(b)):this.superCall("push",b),!0):!1};this.I=function(){this.u=Date.now()+1E3;(this.B=this.i)?this.g.i(16):1==this.h?this.h=3:2==this.h?(this.h=3,this.push([])):this.g.i()};this.J=function(b){try{var d=new CryptoJS.lib.WordArray.init(b);if(!this.A){var e={iv:this.iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7};this.i&&(e.iv=d,d=null);this.A=this.C?CryptoJS.algo.AES.createEncryptor(this.key,
e):CryptoJS.algo.AES.createDecryptor(this.key,e)}if(d){var f=ma(this.A.process(d));this.g.C()&&(f=f.concat(ma(this.A.finalize())));if(this.i<this.g.A()){var g=this.i-(this.g.A()-b.byteLength);0<g&&(f=f.slice(g))}else f=null;this.h?this.push(f):f?this.l&&this.l.write(f,function(){this.g.C()?this.pa():this.H?this.H()?this.g.i():this.l.cancel(function(h,k){this.pa(h,k)}.bind(this)):this.g.i()}.bind(this)):this.g.i();f=null}else this.h?2==this.h?(this.h=3,this.push([])):this.h=3:this.g.i()}catch(h){if(this.h)throw h;
this.pa(h)}};this.pa=function(b,d){this.g&&(this.g.P(),this.g=null);this.o&&(b?this.o(b):this.o(!1,d))}}function pa(a){const c=zb_require("readable-stream");z.super_!==c.Readable&&zb_inherits(z,c.Readable);this.h={highWaterMark:8E5};Object.assign(this.h,void 0);this.info=a;this.g=null;this.createReadStream=function(b){this.Da();this.g=new z(this.info,this.h);var d=0;b&&b.start&&(d=b.start);this.g.start(d);return this.g};this.Da=function(){this.g&&(this.g.destroy(),this.g=null)}}
function qa(a,c,b){a.u=function(d){c.write(d,function(){a.C()?b&&b():a.i()})};a.J(0,function(){c.l(a.h(),function(){a.i()})})};function ra(){this.l=!0;this.h=this.s=null;this.i=this.A=!1;this.L=function(){return null!=this.s};this.J=function(a){if(this.l)try{var c=window.sessionStorage.getItem("language"),b=window.sessionStorage.getItem("relay_url"),d=window.sessionStorage.getItem("drive"),e=window.sessionStorage.getItem("skipLogin");window.sessionStorage.clear();c&&window.sessionStorage.setItem("language",c);b&&!a&&window.sessionStorage.setItem("relay_url",b);d&&!a&&window.sessionStorage.setItem("drive",d);e&&!a&&window.sessionStorage.setItem("skipLogin",
e)}catch(f){this.l=!1,console.error(f)}};this.o=function(a){var c=null;if(this.l)try{c=window.sessionStorage.getItem(a)}catch(b){this.l=!1,console.error(b)}return c};this.ra=function(a){var c=this.o("login_state");return c&&a==c?!0:!1};this.C=function(a,c){if(this.l)try{return window.sessionStorage.setItem(a,c.toString()),!0}catch(b){this.l=!1,console.error(b)}return!1};this.I=function(a){if(this.l)try{window.sessionStorage.removeItem(a)}catch(c){this.l=!1,console.error(c)}};this.ua=function(){var a=
this.o("language"),c=this.o("relay_url"),b=this.o("drive"),d=this.o("skipLogin");this.h={};a&&(this.h.language=a,this.M(a));c&&(this.h.da=c,this.ea(c));b&&(this.h.N=b,this.wa(b));d&&this.xa(d)};this.Ga=function(){var a=this.g("drive");a||(this.h||this.ua(),a=this.h.N);return a};this.wa=function(a){return this.P("drive",a)?(this.s[a]||(this.s[a]={}),!0):this.s?!1:!0};this.xa=function(a){a?this.i=this.L():(this.i=!1,this.Ia()&&(this.A=!0));this.C("skipLogin",this.i)};this.ta=function(a){var c=this.g("language");
!c&&a&&this.h&&(c=this.h.language);return c};this.M=function(a){this.P("language",a)};this.T=function(){var a=this.g("relay_url");!a&&this.h&&(a=this.h.da);return a?a:""};this.ea=function(a){this.P("relay_url",a)};this.La=function(a){if(window.indexedDB){var c=window.indexedDB.open("zgayard1946");c.onerror=function(){if(a)a("IndexedDB is not supported in your browser settings.");else throw Error("IndexedDB is not supported in your browser settings.");};c.onupgradeneeded=function(b){b.target.result.createObjectStore("settings",
{keyPath:"key"})};c.onsuccess=function(b){var d=b.target.result;b=d.transaction("settings","readwrite");b.oncomplete=function(){d.close();a&&a()};b.objectStore("settings").getAll().onsuccess=function(e){this.s={};e.target.result.forEach(function(f){this.s[f.key]=f.value}.bind(this));this.i=(e=this.s.drive)&&this.s[e]&&this.s[e].refresh_token?!0:!1}.bind(this)}.bind(this)}else if(a)a("IndexedDB is not supported in your browser settings.");else throw Error("IndexedDB is not supported in your browser settings.");
};this.Ja=function(a){var c=window.indexedDB.deleteDatabase("zgayard1946");c.onerror=function(){if(a)a("Failed to dropt IndexedDB.");else throw Error("Failed to dropt IndexedDB.");};c.onsuccess=function(){this.J(!0);this.s=null;this.i=!1;a?a():console.log("IndexedDB has been dropped.")}.bind(this)};this.va=function(){this.A&&this.s&&(this.H(function(a){a.clear().onsuccess=function(){for(var c in this.s)a.put({key:c,value:this.s[c]})}.bind(this)}.bind(this)),this.A=!1)};this.u=function(a){var c=this.g("drive");
return c&&(c=this.s[c])?c[a]:null};this.Ia=function(){var a=this.g("drive");return a&&(a=this.s[a])&&a.refresh_token?(delete a.refresh_token,!0):!1};this.B=function(a,c,b){if(this.s){var d=this.g("drive");if(c)this.s[d]||(this.s[d]={}),this.s[d][a]=c;else if(this.s[d])delete this.s[d][a];else{b&&b instanceof Function&&b();return}b?(a=void 0,b instanceof Function&&(a=b),this.H(function(e){e.put({key:d,value:this.s[d]})}.bind(this),a)):this.A=!0}else b&&b instanceof Function&&b()};this.sa=function(a){this.J(!0);
if(this.s){var c=this.g("drive");delete this.s[c].refresh_token;delete this.s.drive;this.H(function(b){b.put({key:c,value:this.s[c]});b.delete("drive")}.bind(this),a)}else a&&a()};this.Ma=function(a,c){this.Ha({drive:this.g("drive"),root:this.u("root"),fid:a,time:c})};this.Ka=function(){var a=this.g("recent");return a&&a.drive==this.g("drive")&&a.root==this.u("root")?a:null};this.H=function(a,c){window.indexedDB.open("zgayard1946").onsuccess=function(b){var d=b.target.result;b=d.transaction("settings",
"readwrite");b.oncomplete=function(){d.close();c&&c()};b=b.objectStore("settings");a&&a(b)}};this.P=function(a,c){if(c){if(this.C(a,c),this.s&&this.s[a]!=c)return this.s[a]=c,this.A=!0}else if(this.I(a),this.s&&this.s[a])return delete this.s[a],this.A=!0;return!1};this.g=function(a){return this.s&&this.s[a]?this.s[a]:null};this.Ha=function(a){this.s&&(this.s.recent=a);this.H(function(c){c.put({key:"recent",value:a})}.bind(this),void 0)}};var A={};function sa(a,c,b){this.m=a;this.v=c;this.g=b}function C(a,c){this.da=null;this.I=c;this.h=null;this.g=a;this.super||(this.super=function(){})}function ta(a){null==a.da&&(a.da=a.g.T());return a.da}
function D(a,c){var b="POST",d=a.C().concat(encodeURI(c.S)),e=new XMLHttpRequest;c&&c.fa&&(b=c.fa);e.open(b,d,!0);c&&c.D?e.setRequestHeader("Authorization",c.D):c&&c.ha?(b="Bearer",c&&c.ia&&(b=c.ia),e.setRequestHeader("Authorization",b+" "+c.ha)):e.setRequestHeader("Authorization",a.h);if(c&&c.aa)for(var f in c.aa)e.setRequestHeader(f,c.aa[f]);c&&c.j&&(e.onload=function(g){g=g.target;4==g.readyState&&(401==g.status&&this.g.i&&!c.Pa?ua(this,c):c.j(g))}.bind(a));e.send(c.la)}
function va(a,c,b){if(b&&(a.h=a.g.o("access_token"),a.h)){c();return}var d=a.g.i,e={};if((b=ja())&&b.token_type&&b.access_token){wa(a,b.token_type,b.access_token);if(b&&b.state)if(a.g.ra(b.state))a.g.I("login_state");else{c("Unauthorized access to this url.");return}c()}else if(b&&b.code?e.code=b.code:d&&(e.qa=a.g.u("refresh_token")),e.code||e.qa){if(b&&b.state)if(a.g.ra(b.state))a.g.I("login_state");else{c("Unauthorized access to this url.");return}xa(a,e,function(f){f&&f.token_type&&f.access_token?
(wa(this,f.token_type,f.access_token),d&&e.code&&f.refresh_token&&this.g.B("refresh_token",f.refresh_token),f.logout&&this.g.C("logout_url",f.logout),c()):f&&f.error?c("["+f.error+"] "+f.error_description):c("Unknown error occured when doing authorization.")}.bind(a))}else d&&(e.Fa=!0),xa(a,e,function(f){f&&f.url?(f.state&&(this.g.C("login_state",f.state)||(f.state=this.o())),f.logout&&this.g.C("logout_url",f.logout),window.location.href=f.url.concat("&state=".concat(encodeURIComponent(f.state)))):
f&&f.error?c("["+f.error+"] "+f.error_description):c("Unknown error occured when doing authorization.")}.bind(a))}
function ya(){var a=E;a.h=null;a.g.I("access_token");var c=a.g.o("logout_url");if(c)window.location.href=c;else{c=new FormData;c.append("drive_type",a.o());c.append("action","logout");var b=new XMLHttpRequest;b.open("POST",a.I,!0);b.withCredentials=!0;b.onload=function(d){d=d.target;4==d.readyState&&200==d.status&&(d=JSON.parse(d.responseText))&&d.logout&&(window.location.href=d.logout)};b.send(c)}}function za(a){var c=E;if(!a||!a.ba)throw Error("newname is not specified.");c.B(a)}
function Aa(a){var c=E;if(!a||!a.F)throw Error("parentid is not specified.");if(!a||!a.na)throw Error("oldparentid is not specified.");c.B(a)}C.prototype.J=function(a,c){c&&c(!1)};C.prototype.T=function(){};function F(a,c){return new Ba(c,a)}function Ca(a){return{R:a.status,K:a.responseText}}
function G(a,c,b,d,e,f,g,h){c={S:c,fa:b,j:function(k){var l=Ca(k),m=!1;d&&k.status!=d&&(m=!0);if(m)if(e&&e.j)e.j(l);else throw Error(JSON.stringify(l));else h(l)}.bind(a)};Da(e,c);f&&(c.aa=f);g&&(c.la=g);D(a,c)}function H(a,c,b,d){G(a,c,"GET",200,b,null,null,function(e){d(e.K)})}function Da(a,c){a.ia&&(c.ia=a.ia);a.ha&&(c.ha=a.ha);a.D&&(c.D=a.D)}function wa(a,c,b){a.h=c+" "+b;a.g.C("access_token",a.h)}
function xa(a,c,b){if(!c)throw Error("Options are not specified when auth onedrive.");var d=new FormData;d.append("drive_type",a.o());c.clientId&&d.append("client_id",c.clientId);c.Sa&&d.append("redirect_uri",c.Sa);c.Qa&&d.append("client_secret",c.Qa);c.code?d.append("code",c.code):c.qa?d.append("refresh_token",c.qa):c.Fa&&d.append("need_code",c.Fa);c=new XMLHttpRequest;c.open("POST",a.I,!0);c.withCredentials=!0;c.onload=function(e){e=e.target;if(4==e.readyState)if(200==e.status)b&&b(JSON.parse(e.responseText));
else throw Error(e.responseText+" ("+e.status+")");};c.send(d)}function ua(a,c){console.log("Retry to send ajax.");c&&(c.Pa=!0,va(a,function(b){b?console.error(b):(c.D=this.h,D(this,c))}.bind(a)))}
function Ea(a){a.ka=C;if("function"===typeof Object.create)a.prototype=Object.create(C.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});else{var c=function(){};c.prototype=C.prototype;a.prototype=new c;a.prototype.constructor=a}a.prototype.getSuperClass||(a.prototype.getSuperClass=function(){return this.constructor.ka});a.prototype.super||(a.prototype.super=function(...b){return this.constructor.ka.call(this,...b)});a.prototype.superCall||(a.prototype.superCall=function(b,
...d){return b?this.constructor.ka.prototype[b].call(this,...d):this.constructor.ka.call(this,...d)})}
function Fa(a,c){this.N=c;this.o=a;this.C="";this.g=this.i=0;this.h=null;if(!this.o||!this.o.X)throw Error("fnm is not specified.");this.l=function(b,d){this.i=b;this.N.P(this.o,b,function(e,f){if(e)this.C=e,d&&d(f);else throw console.error(f),Error(JSON.stringify(f));}.bind(this))};this.write=function(b,d){var e=null;if(this.h){if(this.h instanceof ArrayBuffer){var f=this.h.byteLength;0<f?(e=new Uint8Array(f+b.byteLength),e.set(new Uint8Array(this.h),0),e.set(new Uint8Array(b),f)):e=new Uint8Array(b)}else e=
0<this.h.length?new Uint8Array(this.h.concat(b)):new Uint8Array(b);this.h=null}else e=new Uint8Array(b);var g=new Blob([e],{type:"application/octet-binary"}),h="bytes "+this.g+"-";this.g+=g.size;h+=this.g-1+"/"+this.i;var k=0,l=function(){var m=new XMLHttpRequest;m.open("PUT",this.C,!0);m.setRequestHeader("Content-Range",h);m.onload=function(n){g=null;n=n.target;if(4==n.readyState){var w=this.N.L(n);if(-9==w)throw b=null,Error(n.responseText+" ("+n.status+")");if(-1!=w&&0!=w&&w<this.g){var q=b instanceof
ArrayBuffer?b.byteLength:b.length;q-=this.g-w;if(0<q){q=b.slice(q);b=null;if(this.g>=this.i){this.write(q,d);return}this.h=q;this.g=w}else throw b=null,Error("Can NOT continue to upload buffer.");}d&&d(n.responseText)}}.bind(this);m.onerror=function(){1>k?(k++,setTimeout(function(){l()},500)):g=b=null};m.send(g)}.bind(this);l()};this.cancel=function(b){this.N.J(this.C,b)};this.B=function(){return this.i}}
function Ba(a,c){this.N=c;this.H=a;this.url="";this.name=null;this.I=this.l=this.g=this.size=0;this.T=!1;this.M=16E3;a.U&&(this.M=a.U);this.B=this.o=0;this.u=null;this.J=function(b,d){if(this.T){this.l&&(this.I=this.l,this.l=0);if(b){if(b>=this.h())throw console.log("offset:"+b+",size:"+this.h()),Error("offset can not be bigger than input size.");this.g=b}else this.g=0;d&&d()}else this.N.M(this.H,function(e,f){this.T=!0;if(e){this.size=e._size;this.url=e.m;this.name=e.v;this.B="1"==e._type?1:0;if(b){if(b>=
this.h())throw Error("offset can not be bigger than input size.");this.g=b}d&&d()}else throw Error(f.K+" ("+f.R+")");}.bind(this))};this.A=function(){return this.g};this.h=function(){return this.size};this.C=function(){return this.g>=this.h()};this.i=function(b){b||(b=this.M);this.L(b)};this.P=function(){};this.L=function(b){if(!b||!this.l){if(b)this.l=b;else if(this.l)b=this.l;else throw Error("size must be specified.");if(!this.I){var d=this.g+b-1,e=function(){var f=new XMLHttpRequest;10<=this.o?
(f.open("GET",ta(this.N),!0),f.setRequestHeader("Zb-Url",this.url)):f.open("GET",this.url,!0);this.N.T(f,this.H.D);f.setRequestHeader("Range","bytes="+this.g+"-"+d);f.responseType="arraybuffer";f.onload=function(g){if(this.I)this.I=0,this.l&&this.L();else if(this.l=0,g=g.target,4==g.readyState)if(this.o=10>this.o?1:11,200==g.status||206==g.status){2==this.B&&(this.B=1);var h=parseInt(g.getResponseHeader("content-length"),10);h?this.g+=h:this.g=(h=la(g.getResponseHeader("content-range")))?h+1:d+1;
200==g.status&&this.g<this.h()?this.g=this.h():this.g>this.h()&&(this.g=this.h());this.u&&this.u(g.response,this);g.response=null}else if(401==g.status&&1==this.B)console.log("Retry auth."),this.B=2,va(this.N,function(k){k?console.error(k):(this.H.D&&delete this.H.D,e())}.bind(this));else throw Error(g.responseText+" ("+g.status+")");}.bind(this);f.onerror=function(){if(0==this.o&&ta(this.N))this.o=10,e();else if(1==this.o||11==this.o)this.o++,setTimeout(function(){e()},500)}.bind(this);f.send()}.bind(this);
e()}}}};function Ga(a,c){this.super(a,c);this.o=function(){return"onedrive"};this.H=function(b){H(this,"/me/drive",b,function(d){b&&b.j&&(d=JSON.parse(d).quota,b.j(!1,{Ba:d.deleted,Aa:d.total,Ca:d.used}))})};this.l=function(b){var d="/me/drive/root/children";if(b){if(b._fname){var e=function(f){var g={$:"",j:function(h,k){if(b&&b.j)h?b.j(h):(h=[],k&&h.push(k),b.j(!1,h));else if(h)throw Error(JSON.stringify(h));}};Da(b,g);this.i(g,f)}.bind(this);b.F?(d={$:b.F,j:function(f,g){if(f)if(b&&b.j)b.j(f);else throw Error(JSON.stringify(f));
else e(g.Oa.concat("/").concat(g.v).concat("/").concat(b._fname))}},Da(b,d),this.i(d)):e("/drive/root:/".concat(b._fname));return}b.F&&(d="/me/drive/items/"+b.F+"/children")}H(this,d.concat(v({select:"id,name,parentReference,lastModifiedDateTime,size,folder,file"},!0)),b,function(f){if(b&&b.j){var g=[];f&&JSON.parse(f).value.forEach(function(h){g.push(this.V(h))},this);b.j(!1,g)}}.bind(this))};this.u=function(b){this.i(b)};this.A=function(b){if(!b||!b.Y)throw Error("Name of new folder is not specified.");
var d="/me/drive/root/children";b.F&&(d="/me/drive/items/"+b.F+"/children");var e=JSON.stringify({name:b.Y,folder:{},"@microsoft.graph.conflictBehavior":"fail"});G(this,d,"POST",201,b,{"Content-Type":"application/json;charset=UTF-8"},e,function(f){b&&b.j&&(f=this.V(JSON.parse(f.K)),b.j(!1,f))}.bind(this))};this.delete=function(b){var d="/me/drive/items/".concat(b.O);G(this,d,"DELETE",204,b,null,null,function(){b&&b.j&&b.j(!1)})};this.P=function(b,d,e){d={S:"/me",fa:"POST",D:b.D,aa:{"Content-Type":"application/json;charset=UTF-8",
"Cache-Control":"no-cache",Pragma:"no-cache"},j:function(f){f=Ca(f);var g="";200<=f.R&&299>=f.R&&(g=JSON.parse(f.K).uploadUrl);e(g,f)}.bind(this)};d.S=b.W?"/me/drive/items/"+b.W+":/":d.S+"/drive/root:/";d.S+=b.X;d.S+=":/createUploadSession";d.la=JSON.stringify({item:{"@microsoft.graph.conflictBehavior":"replace",name:b.X}});D(this,d)};this.L=function(b){if(0<=[200,201].indexOf(b.status))return-1;if(0>[202].indexOf(b.status))return-9;if((b=JSON.parse(b.responseText).nextExpectedRanges)&&b.length){var d=
b[0].indexOf("-");if(0<d)return parseInt(b[0].substring(0,d),10)}return 0};this.J=function(b,d){var e=new XMLHttpRequest;e.open("DELETE",b,!0);e.onload=function(f){f=f.target;if(4==f.readyState){var g={R:f.status,K:f.responseText};200<=f.status&&299>=f.status?d&&d(!1,g):(console.log(f.responseText+" ("+f.status+")"),d&&d(g))}}.bind(this);e.send()};this.M=function(b,d){var e="/me/drive/items/".concat(b.m),f={j:function(g,h){var k=null;h&&!g&&(h=JSON.parse(h),k={m:h["@microsoft.graph.downloadUrl"],
v:h.name,_size:h.size});d(k,g)}};b.D&&(f.D=b.D);H(this,e.concat(v({select:"name,size,@microsoft.graph.downloadUrl"},!0)),f,function(g){f.j(!1,g)})};this.C=function(){return"https://graph.microsoft.com/v1.0"};this.B=function(b){if(!b||!b.O)throw Error("fid is not specified.");var d="/me/drive/items/".concat(b.O),e={};b.ba&&(e.name=b.ba);b.F&&(e.parentReference={id:b.F});e=JSON.stringify(e);if("{}"==e)throw Error("No property to be updated.");G(this,d,"PATCH",200,b,{"Content-Type":"application/json;charset=UTF-8"},
e,function(){b&&b.j&&b.j(!1)})};this.i=function(b,d){var e="";e=d?d.startsWith("/me")?d:"/me".concat(d):"/me/drive/items/"+b.$;G(this,e.concat(v({select:"id,name,parentReference,lastModifiedDateTime,size,folder,file"},!0)),"GET",0,b,null,null,function(f){if(b&&b.j)200==f.R?(f=this.V(JSON.parse(f.K)),b.j(!1,f)):404==f.R&&d?b.j(!1):b.j(f);else if(200!=f.R)throw Error(JSON.stringify(f));}.bind(this))};this.V=function(b){var d={m:b.id,v:b.name,_size:b.size,za:b.lastModifiedDateTime,Oa:b.parentReference.path,
_parentId:b.parentReference.id,_type:"0"};b.folder?d._type="1":b.file&&(d._type="2");return d}}Ea(Ga);A.onedrive=new sa("onedrive","Microsoft OneDrive",Ga);function Ha(a,c){this.super(a,c);this.o=function(){return"googledrive"};this.H=function(b){var d=this.i("/about").concat(v({fields:"storageQuota"}));H(this,d,b,function(e){b&&b.j&&(e=JSON.parse(e).storageQuota,b.j(!1,{Ba:e.usageInDriveTrash,Aa:e.limit,Ca:e.usage}))})};this.l=function(b){var d=this.i("/files"),e="'"+(b.F?b.F:"root")+"' in parents";b._fname&&(e=e.concat(" and name = '"+b._fname+"'"));H(this,d.concat(v({fields:"files(id,name,mimeType,parents,modifiedTime,size)",q:e},!0)),b,function(f){if(b&&
b.j){var g=[];JSON.parse(f).files.forEach(function(h){g.push(this.V(h))},this);b.j(!1,g)}}.bind(this))};this.u=function(b){var d=this.i("/files/").concat(b.$);H(this,d.concat(v({fields:"id,name,mimeType,parents,modifiedTime,size"},!0)),b,function(e){b&&b.j&&(e=this.V(JSON.parse(e)),b.j(!1,e))}.bind(this))};this.A=function(b){if(!b||!b.Y)throw Error("Name of new folder is not specified.");var d=this.i("/files");G(this,d,"POST",200,b,{"Content-Type":"application/json;charset=UTF-8"},JSON.stringify({mimeType:"application/vnd.google-apps.folder",
name:b.Y,parents:[b.F?b.F:"root"]}),function(e){b&&b.j&&(e=this.V(JSON.parse(e.K)),b.j(!1,e))}.bind(this))};this.delete=function(b){var d=this.i("/files/").concat(b.O);G(this,d,"DELETE",204,b,null,null,function(){b&&b.j&&b.j(!1)})};this.P=function(b,d,e){var f=function(h){var k={},l="POST",m="/files?uploadType=resumable";h?(l="PATCH",m="/files/"+h+"?uploadType=resumable"):(k.name=b.X,b.W&&(k.parents=[b.W]));h={S:"/upload".concat(this.i(m)),fa:l,D:b.D,aa:{"X-Upload-Content-Length":d,"X-Upload-Content-Type":"application/octet-stream",
"Content-Type":"application/json; charset=UTF-8"},la:JSON.stringify(k),j:function(n){var w=Ca(n),q="";200<=w.R&&299>=w.R&&(q=n.getResponseHeader("location"));e(q,w)}.bind(this)};D(this,h)}.bind(this),g={j:function(h,k){h?e("",h):0<k.length?f(k[0].m):f()},_fname:b.X,D:b.D};b.W&&(g.F=b.W);this.l(g)};this.L=function(b){if(0<=[200,201].indexOf(b.status))return-1;if(0>[308].indexOf(b.status))return-9;if(b=b.getResponseHeader("range")){var d=b.indexOf("-");if(0<d)return parseInt(b.slice(d+1),10)+1}return 0};
this.M=function(b,d){var e=this.i("/files/").concat(b.m),f={$:b.m,j:function(g,h){var k=null;h&&!g&&(k=h,k.m=this.C().concat(encodeURI(e)).concat(v({alt:"media"})),this.g.i&&(k._type="1"));d(k,g)}.bind(this)};b.D&&(f.D=b.D);this.u(f)};this.T=function(b,d){d?b.setRequestHeader("Authorization",d):b.setRequestHeader("Authorization",this.h?this.h:"")};this.C=function(){return"https://www.googleapis.com"};this.B=function(b){var d=!0,e=this.i("/files/").concat(b.O);b.na&&b.F&&(e=e.concat(v({addParents:b.F,
removeParents:b.na})),d=!1);var f={};b.ba&&(f.name=b.ba,d=!1);if(d)throw Error("No property to be updated.");G(this,e,"PATCH",200,b,{"Content-Type":"application/json;charset=UTF-8"},JSON.stringify(f),function(){b&&b.j&&b.j(!1)})};this.i=function(b){return"/drive/v3".concat(b)};this.V=function(b){var d={m:b.id,v:b.name,_size:b.size,za:b.modifiedTime,_type:"2"};b.parents&&0<b.parents.length&&(d._parentId=b.parents[0]);this.ea(b.mimeType)&&(d._type="1");return d};this.ea=function(b){return"application/vnd.google-apps.folder"==
b}}Ea(Ha);A.googledrive=new sa("googledrive","Google Drive",Ha);function Ia(a,c){var b=I;this.g=this.h=null;this.A=b;this.i=1;this.u=a;this.l=c;this.o=function(){var d=new z({ma:1==this.i,Z:this.A,ga:this.h,oa:this.g});d.H=function(){var e={_type:1,_wtype:this.i,_speed:d.L(),_pos:this.h.A(),_size:this.h.h()};this.l(e);return this.u()?!1:!0}.bind(this);d.o=function(e,f){var g={_type:2,_wtype:this.i,_size:this.g.B()};e?g._err=e.message||e.Ua:f?g._type=3:this.g.A&&(g._blob=this.g.A());this.l(g)}.bind(this);d.start()};this.Ra=function(d){var e=E;this.i=1;this.h=F(e,
{m:d,U:16E5});this.g=new na;this.o()};this.Ta=function(d,e,f){var g=E;this.i=2;this.h=new oa({_blob:e,U:16E5});this.g=new Fa({X:d,W:f},g);this.o()}};var J=null,E=null,K=[],L=0,I=null,M=[],N=0;function O(a){var c=document.getElementById("spanError");"string"===typeof a?window.msgs&&a&&window.msgs[a]?c.innerText=window.msgs[a]:c.innerText=a:a&&(c.innerText=JSON.stringify(a));document.getElementById("spanInfo").style.display="none";c.style.display=a?"block":"none"}
function P(a){var c=document.getElementById("spanInfo");window.msgs&&a&&window.msgs[a]?c.innerText=window.msgs[a]:c.innerText=a;document.getElementById("spanError").style.display="none";c.style.display=a?"block":"none"}
function Q(a){var c=document.getElementById("spanNotify");window.msgs&&a&&window.msgs[a]?c.innerText=window.msgs[a]:c.innerText=a;a&&(N&&(clearTimeout(N),N=0),c.style.top=(document.documentElement.scrollTop||document.body.scrollTop)+20+"px",c.style.display="",N=setTimeout(function(){c.style.display="none";N=0},3E3))}
function R(a,c){function b(e){Ja--;"error"==e.type&&(R.Ea=!0);if(0==Ja){var f=R.Ea;delete R.Ea;c&&c(f)}e=e.target||e.srcElement;e.hasAttribute("temporary")&&e.remove()}Ja++;var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);d.setAttribute("temporary","1");d.addEventListener("load",b);d.addEventListener("error",b);document.body.appendChild(d)}var Ja=0;
function Ka(a){J.L()&&(document.getElementById("chkSaveKey").checked?La(function(c){var b="";c&&c.lsauth&&(b=y(!0,a,c.lsauth).toString(CryptoJS.enc.Base64url));J.B("key_words",b,!0)}):J.B("key_words",null,!0))}function Ma(){J.sa(function(){ya()})}
function La(a){var c=new FormData;c.append("drive_type","localstorage");var b=new XMLHttpRequest;b.open("POST","https://zgayard.f5.si/grantauth.php",!0);b.withCredentials=!0;b.onload=function(d){var e=d.target;4==e.readyState&&(d=null,200==e.status?(e=JSON.parse(e.responseText))?e.error?O("["+e.error+"] "+e.error_description):e.lsauth?d=e:O("lsFailed"):O("lsFailed"):O(e.responseText+" ("+e.status+")"),a&&a(d))};b.send(c)}
function Na(a){var c=document.getElementById("divSet"),b=document.getElementById("selDrive"),d=fa(b,"input");a?(b.disabled=!0,d.style.display="",c.setAttribute("cancelAll","1"),S(),document.getElementById("divHeader").style.display="",document.getElementById("tblst").style.display="",document.getElementById("tblQueue").style.display="",document.getElementById("divAction").style.display="",document.getElementById("divHistory").style.display=""):(b.disabled=!1,d.style.display="none");c.style.display=
"block"}function Oa(a){if(!window.msgs||window.msgs.lang!=a){var c=window.msgs;window.msgs=null;R("msg/"+a+".js",function(){window.msgs?(window.msgs.lang=a,J.M(a),Pa()):(console.log("Message file of '"+a+"' is missing."),c?window.msgs=c:R("msg/en.js",function(){window.msgs?(window.msgs.lang="en",J.M(window.msgs.lang),Pa()):O("Message file is missing.")}))})}}
function Pa(){var a=window.msgs;a.spanConfNotice=a.spanConfNotice.replace("{0}","_zgayard_.conf");for(var c=document.getElementsByTagName("*"),b=0;b<c.length;b++){var d=c[b],e=null;d.hasAttribute("wordid")&&(e=a[d.getAttribute("wordid")]);!e&&d.id&&(e=a[d.id]);e&&("button"==d.type?d.value=e:d.innerText=e);d.hasAttribute("tid")&&(e=a[d.getAttribute("tid")])&&(d.title=e)}c=document.getElementById("seLang");for(b in aa)d=document.createElement("option"),d.value=b,d.innerText=aa[b],b==a.lang&&(d.selected=
!0),c.appendChild(d)}function Qa(a){P("loading");(a=A[a])?(E=new a.g(J,"https://zgayard.f5.si/grantauth.php"),va(E,function(c){c?J.sa(function(){O(window.msgs.loginFailed.replace("{0}",c))}):(J.va(),E.l({j:function(b,d){b?O(JSON.stringify(b)):0==d.length?S(!0,!0):Ra(d[0].m)},_fname:"_zgayard_.conf"}))},!0)):O("unkDrive")}
function Sa(){var a=!1;document.getElementById("selDrive").disabled||(a=J.wa(document.getElementById("selDrive").value));J.xa(document.getElementById("chkSkipLogin").checked);J.ea(document.getElementById("txtRelay").value);Oa(document.getElementById("seLang").value);a?(J.J(),Qa(document.getElementById("selDrive").value)):J.va();Ta()}
function Ta(a){var c=document.getElementById("divSet"),b=!1;a&&"boolean"===typeof a?b=!0:"1"==c.getAttribute("cancelAll")&&(b=!0);b&&(document.getElementById("divPwd").style.display="",document.getElementById("divHeader").style.display="block",document.getElementById("tblst").style.display="block",document.getElementById("tblQueue").style.display="block",document.getElementById("divAction").style.display="block",a=document.getElementById("divHistory"),a.getElementsByTagName("a")[0].innerText&&(a.style.display=
"block"),c.removeAttribute("cancelAll"));c.style.display=""}
function Ua(a,c){var b=document.getElementById("divPwd"),d="none";a?(b.setAttribute("addroot","1"),d="block"):b.removeAttribute("addroot");a=b.getElementsByTagName("*");for(b=0;b<a.length;b++){var e=a[b];e.classList.contains("addroot")?e.style.display=d:e.classList.contains("firstep")?e.style.display="none"!=d&&c?"block":"none":e.classList.contains("chgroot")&&(e.style.display="none"==d?"block":"none");"password"==e.type&&(e.value="")}Va("#lblKeyFile")}
function Wa(){if(confirm(window.msgs.delConfirm)){P("deleting");var a=document.getElementById("selRoot"),c=a.value,b=-1;K.forEach(function(f,g){f.root==c&&(b=g)});var d=function(){if(b==L)window.location.reload();else{var f=a.getElementsByTagName("option"),g;for(g=0;g<f.length;g++){var h=f[g];if(h.value==c){a.removeChild(h);break}}P();Q("delrootDone")}};if(0<=b){var e=function(f){E.delete({j:function(g){g?O(g.K):(K.splice(b,1),Xa(d))},O:f})};E.l({j:function(f,g){f?console.error(f):0==g.length?(K.splice(b,
1),Xa(d)):e(g[0].m)},_fname:K[b].root})}else d()}}function S(a,c){var b=document.getElementById("divPwd");Ua(a,c);b.style.display="block";P()}function Ya(){"1"==document.getElementById("divSet").getAttribute("cancelAll")?Ta(!0):document.getElementById("divPwd").style.display=""}function Za(){var a=p(),c=a.previousElementSibling.cloneNode();c.value="";a.parentElement.insertBefore(c,a)}
function Va(a){a=p(a).parentElement.getElementsByTagName("input");for(var c=a.length-1;0<c;c--)a[c].remove();a[0].value=""}
function ab(){P("loading");for(var a=document.getElementById("divPwd").hasAttribute("addroot"),c=document.getElementById("pwdKey").value,b=document.getElementById("divfKey").getElementsByTagName("input"),d=[],e=0;e<b.length;e++)for(var f=b[e].files,g=0;g<f.length;g++)d.push(f[g]);if(c||0<d.length){if(a){b=document.getElementById("pwdKeyRe").value;if((c||b)&&c!=b){O("diffPwd");return}if(!document.getElementById("txtRoot").value){O("noRoot");return}}var h=null;c&&(h=CryptoJS.enc.Utf8.parse(c));if(0<
d.length){e=0;var k=new FileReader,l=CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA512,"zb12");k.h=function(){k.readAsArrayBuffer(d[e].slice(0,1023));e++};k.onload=function(m){l.update(new CryptoJS.lib.WordArray.init(m.target.result));e<d.length?k.h():(h?h.concat(l.finalize()):h=l.finalize(),h.clamp(),bb(h,a))};k.h()}else bb(h,a)}else O("noPwd")}
function bb(a,c){var b=CryptoJS.HmacMD5(a,"zgayard").toString(CryptoJS.enc.Base64url).slice(0,8),d=null;if(c){var e={root:document.getElementById("txtRoot").value};document.getElementById("chkEncryFname").checked&&(e.encfname=!0);var f=!1;K.forEach(function(k){k.root==e.root&&(f=!0)});f?O("dupRoot"):(J.B("root",e.root),Ka(a),d=CryptoJS.lib.WordArray.random(1024),I=x(d),e.iv=b.concat(cb(!0,d,a)),L=K.length,K.push(e),db(e,!0),Xa())}else{var g=document.getElementById("selRoot").value,h=-1;K.forEach(function(k,
l){k.root==g&&(h=l)});0<=h&&K[h].iv&&b==K[h].iv.slice(0,b.length)?(L=h,J.B("root",g),Ka(a),d=cb(!1,K[L].iv.slice(b.length),a),I=x(d),eb()):da()?O("pwdError"):S()}}function cb(a,c,b){b=x(b);var d=null;a?d=c:d=CryptoJS.enc.Base64url.parse(c);c=y(a,d,b);return a?c.toString(CryptoJS.enc.Base64url):c}
function Xa(a){var c=CryptoJS.enc.Utf8.parse(JSON.stringify(K));c=new Blob([new Uint8Array(ma(c))],{type:"application/octet-binary"});c=new oa({_blob:c,U:262144});var b=new Fa({X:"_zgayard_.conf"},E);qa(c,b,a||eb)}
function Ra(a){var c=new na;qa(F(E,{m:a}),c,function(){var b=new CryptoJS.lib.WordArray.init(c.u());b=JSON.parse(b.toString(CryptoJS.enc.Utf8));Array.isArray(b)?K=b:K.push(b);var d=-1,e=J.u("root"),f=document.getElementById("selRoot");f.innerHTML="";K.forEach(function(h,k){var l=!1;e&&h.root==e&&(l=!0);db(h,l,f);l&&(d=k)});if(0<=d){L=d;var g=J.u("key_words");g?La(function(h){h&&h.lsauth&&!h.newkey?(h=y(!1,CryptoJS.enc.Base64url.parse(g),h.lsauth),bb(h)):S()}):S()}else L=0,S()})}
function db(a,c,b){b=b||document.getElementById("selRoot");var d=document.createElement("option");d.value=a.root;d.innerText=a.root;c&&(d.selected=!0);b.appendChild(d)}function fb(){confirm(window.msgs.dropConfirm)&&J.Ja(function(a){a?O(a):ya()})};function gb(a){if(K[L].encfname){var c=I;a=CryptoJS.enc.Utf8.parse(a);c=y(!0,a,c).toString(CryptoJS.enc.Base64url)}else c=a;return c}function hb(a){if(K[L].encfname)try{var c=I,b=CryptoJS.enc.Base64url.parse(a);return y(!1,b,c).toString(CryptoJS.enc.Utf8)}catch(d){console.error(d)}return a}
function ib(){J=new ra;J.La(function(a){a&&O("IndexedDB is not supported in your browser settings.");a=J.ta();a||(J.ua(),a=J.ta(!0));if(!a){a=navigator.language;var c=a.indexOf("-");0<c&&(a=a.substring(0,c))}Oa(a);document.getElementById("txtRelay").value=J.T();a=J.Ga();c=document.getElementById("selDrive");var b=ja(),d;for(d in A){var e=document.createElement("option");e.value=d;e.innerText=A[d].v;a?a==d&&(e.selected=!0):b&&b.state==A[d].m&&(a=d,e.selected=!0);c.appendChild(e)}J.L()&&(document.getElementById("divSkipLogin").style.display=
"block",document.getElementById("divSaveKey").style.display="block",J.i&&(document.getElementById("chkSkipLogin").checked=!0),J.u("key_words")&&(document.getElementById("chkSaveKey").checked=!0));a?Qa(a):Na()})}function eb(){Ya();jb(function(){var a=K[L].root;E.l({_fname:a,j:function(c,b){c?O(JSON.stringify(c)):b&&0<b.length?(M=[],M.push(b[0]),T(),kb()):E.A({Y:a,j:function(d,e){d?O(JSON.stringify(d)):(M=[],M.push(e),T())}})}})})}
function jb(a){E.H({j:function(c,b){if(c)O(c);else{c=document.getElementById("spanQuota");c.setAttribute("total",b.Aa);c.setAttribute("trash",b.Ba);c=b.Ca;b=document.getElementById("spanQuota");"string"==typeof c&&(c=parseInt(c,10));var d=parseInt(b.getAttribute("total"),10),e=parseInt(b.getAttribute("trash"),10),f=0;b.hasAttribute("used")&&(f=parseInt(b.getAttribute("used"),10));f+=c;b.setAttribute("used",f);c=d-f-e;b.innerText=window.msgs.quotaInfo.replace("{0}",A[E.o()].v).replace("{1}",ka(c));
a&&a()}}})}
function kb(){var a=document.getElementById("divHistory");a.style.display="";var c=J.Ka();c&&E.u({$:c.fid,j:function(b,d){if(!b){b=a.getElementsByTagName("a")[0];b.innerText=hb(d.v);b.setAttribute("fid",d.m);d._parentId&&b.setAttribute("parentId",d._parentId);if(c.time){b.setAttribute("time",c.time);d=b.innerText.concat(" [");var e=d.concat,f=Math.floor(c.time),g=Math.floor(f/3600);f-=3600*g;var h=Math.floor(f/60);f-=60*h;var k=[];0<g?(k.push(g.toString()),k.push("0".concat(h).slice(-2))):k.push(h.toString());
k.push("0".concat(f).slice(-2));b.innerText=e.call(d,k.join(":")).concat("]")}a.style.display="block"}}})}
function T(a,c,b,d){var e=0;if(!b){if(0>=M.length)return;e=M.length-1;b=M[e]}var f="#tblst";c&&(f="#tblFolder");f=t(f);var g=f.ca,h=f.G;h.innerHTML="";P("loading");f=g.getElementsByTagName("th")[0];var k=u(f,"a",!0);a?k&&k.classList.remove("fnormal"):(k&&(0!=e||c?k.classList.add("fnormal"):f.innerHTML=""),lb(f,b,e));E.l({j:function(l,m){if(l)O(l);else{var n=[],w=0;m.forEach(function(q){var B=0,$a=n.length;q.v=hb(q.v);for(U(q)?$a=w++:B=w;B<$a&&!(q.v<n[B].v);)B++;B<n.length?n.splice(B,0,q):n.push(q)});
n.forEach(function(q){c&&!U(q)||mb(h,q,c)});c||(document.getElementById("divHeader").style.display="block",g.style.display="block",document.getElementById("divAction").style.display="block",l=document.getElementById("chkAll"),l.checked=!1,l.style.display=0<m.length?"":"none");d&&d(n);P()}},F:b.m})}
function lb(a,c,b,d){var e=document.createElement("a"),f=document.createElement("span");e.href="#";e.innerText=c.v;e.setAttribute("uid",c.m);e.setAttribute("idx",b);e.addEventListener("click",nb);d&&e.classList.add("fnormal");a.appendChild(e);f.innerText=">";a.appendChild(f)}
function V(a,c){var b=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","use");c&&b.classList.add(c);d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(a));b.appendChild(d);return b}
function mb(a,c,b){var d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("a"),g=c.v;if(!b){var h=document.createElement("input"),k=document.createElement("span"),l=document.createElement("span");h.type="checkbox";e.appendChild(h);U(c)?k.appendChild(V("folder","folder")):(h=ob(g),ba[h]?k.appendChild(V("image","fgreen")):ca[h]?k.appendChild(V("video","fpink")):k.appendChild(V("file","fyellow")));e.appendChild(k)}f.innerText=g;f.href="#";f.setAttribute("uid",c.m);
f.setAttribute("utype",c._type);f.addEventListener("click",W);e.appendChild(f);b||(l.appendChild(V("edit")),l.classList.add("dropbtn"),l.addEventListener("click",pb),e.appendChild(l));d.appendChild(e);b||(e=document.createElement("td"),e.innerText=ka(c._size),e.setAttribute("class","right"),d.appendChild(e),b=e=document.createElement("td"),(c=c.za)?(c=new Date(c),f=[],g=[],f.push(c.getFullYear()),f.push(c.getMonth()+1),f.push(c.getDate()),g.push("0".concat(c.getHours()).slice(-2)),g.push("0".concat(c.getMinutes()).slice(-2)),
g.push("0".concat(c.getSeconds()).slice(-2)),c=f.join("-")+" "+g.join(":")):c="",b.innerText=c,d.appendChild(e));a.appendChild(d)}
function W(a,c){if(!a||a instanceof Event){window.event.preventDefault();c=p();if(U(c)){r(c,"TABLE").getAttribute("onlyfolder")?T(!1,!0,{m:c.getAttribute("uid"),v:c.innerText}):(M.push({m:c.getAttribute("uid"),v:c.innerText}),T());return}var b=t("#tblFileDetail").G;var d=t("#tblst").G.rows;var e=r(c,"TR").rowIndex-d[0].rowIndex}else{b=t("#tblFileDetail").G;d=t("#tblst").G.rows;e=b.rows[0].getAttribute("rowidx");if(1==a)if(0<e)e--;else{if(c)return;e=d.length-1}else if(e++,e>=d.length){if(c)return;
e=0}c=d[e].getElementsByTagName("a")[0];if(U(c)){b.rows[0].setAttribute("rowidx",e);W(a);return}}b.rows[0].cells[1].getElementsByTagName("span")[0].innerText=c.innerText;b.rows[0].setAttribute("uid",c.getAttribute("uid"));b.rows[0].setAttribute("rowidx",e);b.rows[1].cells[0].innerText=window.msgs.thSize+": "+d[e].cells[1].innerText;qb(c.getAttribute("uid"),c.innerText)}
function nb(){window.event.preventDefault();var a=p(),c=r(a,"TABLE"),b=c.getElementsByTagName("th")[0];if(c.getAttribute("onlyfolder")){c=0;for(var d=a.nextElementSibling;d;)d.tagName==a.tagName&&c++,d=d.nextElementSibling;if(0<c)for(d=0;d<c;d++)b.removeChild(b.lastElementChild),b.removeChild(b.lastElementChild);T(!0,!0,{v:a.innerText,m:a.getAttribute("uid")})}else a=parseInt(a.getAttribute("idx"),10),a<M.length-1&&M.splice(a+1).forEach(function(){b.removeChild(b.lastElementChild);b.removeChild(b.lastElementChild)}),
T(!0)}function U(a){return"1"==(a instanceof HTMLElement?a.getAttribute("utype"):"string"==typeof a?a:a._type)}function ob(a){var c=a.lastIndexOf("."),b="";0<=c&&(b=a.slice(c+1));return b.toLowerCase()}function rb(){for(var a=p().checked,c=t("#tblst").G.getElementsByTagName("input"),b=0;b<c.length;b++)"checkbox"==c[b].type&&(c[b].checked=a)}
function sb(a){var c=document.getElementById("divGround");1==a?(c.style.backgroundColor="transparent",document.getElementById("tblFileDetail").parentElement.style.display="none"):(c.style.backgroundColor="",document.getElementById("tblFileDetail").parentElement.style.display="",2==a?(document.getElementById("spanGroundTitle").innerText=window.msgs.gtlFDetail,document.getElementById("tblFileDetail").style.display=""):document.getElementById("tblFileDetail").style.display="none",3==a?(document.getElementById("spanGroundTitle").innerText=
window.msgs.gtlMoveto,a=document.getElementById("tblFolder"),a.getElementsByTagName("th")[0].innerHTML=null,a.style.display=""):document.getElementById("tblFolder").style.display="none");c.style.display="table"}
function pb(){var a=p(),c=t("#tblst").G.rows;c=r(a,"TR").rowIndex-c[0].rowIndex;var b=document.getElementById("divItemenu");a=a.getBoundingClientRect();b.style.left=a.right+"px";b.style.top=(document.documentElement.scrollTop||document.body.scrollTop)+a.top+"px";b.style.display="block";b.setAttribute("rowidx",c);sb(1)}
function tb(){var a=p(),c=r(a,"DIV"),b=document.getElementById("divItemenu");var d=t("#tblst").G.rows;b=parseInt(b.getAttribute("rowidx"),10);d=d[b].getElementsByTagName("a")[0];c.style.display="";switch(a.getAttribute("wordid")){case "btnDownload":U(d)?O("noDownFolder"):(c.setAttribute("uid",d.getAttribute("uid")),c.setAttribute("uname",d.innerText),ub(2));X();break;case "btnRename":a=document.getElementById("divNewName");c=a.getElementsByTagName("input")[0];b=d.getBoundingClientRect();c.value=d.innerText;
a.style.left=b.left+"px";a.style.top=(document.documentElement.scrollTop||document.body.scrollTop)+b.top-2+"px";c.style.width=b.width+"px";c.style.height=b.height+"px";a.style.display="block";break;case "btnMove":vb(d.getAttribute("uid"));break;case "btnDelete":wb(d.getAttribute("uid")),X()}}function vb(a){if("string"==typeof a)document.getElementById("tblFolder").setAttribute("uid",a);else if(xb())document.getElementById("tblFolder").removeAttribute("uid");else return;sb(3);T(!1,!0,M[0])}
function yb(){var a=window.event;if(13===a.keyCode){if(a.shiftKey||a.ctrlKey||a.altKey)return!0}else return!0;zb();return!1}
function zb(){var a=p();"INPUT"!=a.tagName&&(a=u(a,"INPUT"));if(a.value){var c=document.getElementById("divItemenu"),b=t("#tblst").G.rows;c=parseInt(c.getAttribute("rowidx"),10);var d=b[c].getElementsByTagName("a")[0];a.value!=d.innerText&&(b=gb(a.value),b={j:function(e){e?O(e.K):(d.innerText=a.value,Q("renDone"))},O:d.getAttribute("uid"),ba:b},za(b));X()}else O("noNewName")}
function Ab(){X();var a=document.getElementById("tblFolder"),c=u(a.getElementsByTagName("th")[0],"a",!0).getAttribute("uid");if(c!=M[M.length-1].m){var b=null;(a=a.getAttribute("uid"))?(b=[],b.push({m:a,v:""})):b=xb();if(b){P("moving");var d=0,e={j:function(f){f?O(f.K):(d++,d<b.length?(e.O=b[d].m,Aa(e)):(T(!0),Q("moveDone")))},O:b[d].m,F:c,na:M[M.length-1].m};Aa(e)}}}
function wb(a){var c=null;"string"==typeof a?(c=[],c.push({m:a,v:""})):c=xb();if(c&&confirm(window.msgs.delConfirm)){P("deleting");var b=0,d={j:function(e){e?O(e.K):(b++,b<c.length?(d.O=c[b].m,E.delete(d)):(T(!0),Q("delDone")))},O:c[b].m};E.delete(d)}}function Bb(){var a=document.getElementById("txtName").value;if(a){var c={j:function(b,d){b?O(b.K):(d.v=a,mb(t("#tblst").G,d),Q("flDone"))},Y:gb(a)};0<M.length&&(c.F=M[M.length-1].m);E.A(c)}else O("noFldName")}
function xb(a){for(var c=[],b=t("#tblst").G.getElementsByTagName("input"),d=0;d<b.length;d++){var e=b[d];if("checkbox"==e.type&&e.checked){e=fa(e,"a");if(a&&U(e))return O("noDownFolder"),null;c.push({v:e.innerText,m:e.getAttribute("uid")})}}return 0>=c.length?(O("noChecks"),null):c}
function qb(a,c){var b=t("#tblFileDetail").G;sb(2);var d=ob(c),e=b.rows[0].cells[1].getElementsByTagName("span")[0],f=b.rows[0].cells[1].getElementsByTagName("img")[0],g=ba[d];d=ca[d];var h=document.getElementById("spanGroundTitle");h.innerText=window.msgs.gtlFDetail;e.style.display="";f.style.display="none";f.src="";var k=Cb(b);b.rows[1].style.display="";b.rows[2].style.display="";if(d)h.innerText=c,Db(k,a),k.style.display="",e.style.display="none",b.rows[1].style.display="none",b.rows[2].style.display=
"none";else if(g){var l=new na;a=new z({ma:!0,Z:I,ga:F(E,{m:a,U:16E4}),oa:l});a.o=function(m,n){m||n?console.log(m||n):(m=l.u(),m instanceof Uint8Array||(m=new Uint8Array(m)),g&&(f.src=window.URL.createObjectURL(new Blob([m],{type:g})),f.title=c,f.style.display="",e.style.display="none",h.innerText=c,b.rows[1].style.display="none",b.rows[2].style.display="none"))};a.start()}}function Eb(){var a=p();a&&a.src&&window.URL.revokeObjectURL(a.src)}
function Db(a,c){var b=F(E,{m:c});const d=zb_require("videostream");a.g=c;a.i=new pa({ma:!0,Z:I,ga:b});a.h=new d(a.i,a)}function X(){document.getElementById("divGround").style.display="";Cb();document.getElementById("divItemenu").style.display="";document.getElementById("divNewName").style.display=""}
function Cb(a){a||(a=t("#tblFileDetail").G);a=a.rows[0].cells[1].getElementsByTagName("video")[0];a.g&&J.Ma(a.g,a.currentTime);a.style.display="none";a.h&&(a.h.destroy(),a.i.Da(),delete a.h,delete a.i);return a}function Fb(a){window.event.preventDefault();a=p(a);Gb(a)}function Hb(a){a=p(a);a=u(a,"a");Gb(a,!0)}
function Gb(a,c){document.getElementById("divHistory").style.display="";var b=a.getAttribute("fid");if(b){var d=a.getAttribute("parentId"),e=a.getAttribute("time");P("loading");var f=[],g=function(){d?E.u({$:d,j:function(k,l){k||(l.v=hb(l.v),f.unshift(l),l._parentId==M[0].m?(f.unshift(M[0]),h()):(l._parentId==M[0]._parentId?d=void 0:d=l._parentId,g()))}}):P()},h=function(){var k=0,l=t("#tblst").ca.getElementsByTagName("th")[0];l.innerHTML="";for(k=0;k<f.length;k++)lb(l,f[k],k,!0);M=f;T(!0,!1,void 0,
function(m){var n;for(n=0;n<m.length&&m[n].m!=b;n++);n<m.length&&(m=t("#tblFileDetail").G.rows[0],c?(m.setAttribute("rowidx",n),W(2,!0)):(m.getElementsByTagName("video")[0].setAttribute("ctime",e),0==n?(m.setAttribute("rowidx",1),W(1,!0)):(m.setAttribute("rowidx",n-1),W(2,!0))))})};g()}}function Ib(a){a=p(a);var c=a.getAttribute("ctime");c&&(a.removeAttribute("ctime"),document.getElementById("divHistory").getElementsByTagName("a")[0].getAttribute("fid")==a.g&&(a.currentTime=c))};const Jb=window.Worker?!0:!1;var Y=null;function Kb(a){this.h=a;this.g=[];this.o=function(c){return this.h.m==c.m};this.u=function(c){return this.h.v==c};this.l=function(c){var b;for(b=0;b<this.g.length;b++)if(this.g[b].u(c))return this.g[b];return null};this.i=function(c){var b;for(b=0;b<this.g.length;b++)if(this.g[b].o(c))return this.g[b];c=new Kb(c);this.g.push(c);return c}}var Lb=null;
function Mb(){var a=p();a.disabled=!0;Y?(a={_type:9,_rowIdx:parseInt(r(a,"TR").getAttribute("rowIdx"),10)},Y.postMessage(a)):a.setAttribute("canceled","1")}function Nb(){var a=t("#tblQueue"),c=a.ca;a=a.G;var b=!1,d;for(d=0;d<a.rows.length;d++)a.rows[d].getAttribute("end")?ea(a.rows[d]):b=!0;b||ea(c)}
function Ob(a,c,b){var d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("span"),g=document.createElement("input");e.innerText=b;d.appendChild(e);e=document.createElement("td");f.innerText=window.msgs.waiting;e.appendChild(f);d.appendChild(e);e=document.createElement("td");g.type="button";g.value=window.msgs.btnCancel;g.style.display="none";g.addEventListener("click",Mb);e.appendChild(g);d.appendChild(e);d.setAttribute("rowIdx",c);a.appendChild(d)}
function Z(a,c,b){var d=a;0<=c&&(d=a.rows[c].getElementsByTagName("span")[0]);d.innerText=b}function Pb(a,c){var b=a;0<=c?(b=a.rows[c].getElementsByTagName("input")[0],a.rows[c].setAttribute("end","1")):(a=r(a,"TR"))&&a.setAttribute("end","1");b.style.display="none";window.gc&&window.gc()}
function Qb(a,c){var b=!1,d=c._rowIdx;switch(c._type){case 0:c=a.rows[d].getElementsByTagName("input")[0];a.rows[d].getElementsByTagName("span")[0].innerText="0%";c.style.display="";break;case 1:Z(a,d,c._speed+" "+Math.round(100*c._pos/c._size)+"%");break;case 2:c._finished&&Y&&Rb();Pb(a,d);c._err?Z(a,d,c._err):1==c._wtype?(Z(a,d,window.msgs.downDone),c._blob&&ha(c._blob,a.rows[d].cells[0].innerText,document.getElementById("download"))):Z(a,d,window.msgs.upDone);b=!0;break;case 3:c._finished&&Y&&
Rb(),Pb(a,d),1==c._wtype?Z(a,d,window.msgs.downCanceled):Z(a,d,window.msgs.updCanceled),b=!0}return b}function Rb(){var a=Y;Lb=Y=null;a.terminate();a.h&&T(!0)}function Sb(a){if(!Y){var c=t("#tblQueue").G;Y=new Worker("worker.js");Y.i={_token:E.h?E.h:"",_iv:I.iv.toString(CryptoJS.enc.Base64url),_key:I.key.toString(CryptoJS.enc.Base64url),_drvnm:E.o()};Y.addEventListener("message",function(b){Qb(c,b.data)})}a._cominf=Y.i;2!=a._type||Y.h||(Y.h=!0);Y.postMessage(a)}
function Tb(a,c,b){Qb(a,{_type:0,_wtype:1,_size:0,_rowIdx:c});var d=a.rows[c].getElementsByTagName("input")[0];return new Ia(function(){return d.getAttribute("canceled")?!0:!1},function(e){e._rowIdx=c;Qb(a,e)&&b()})}
function ub(a){P();var c=[];switch(a){case 1:a=t("#tblFileDetail").G.rows[0];c.push({v:a.getElementsByTagName("span")[0].innerText,m:a.getAttribute("uid")});break;case 2:a=document.getElementById("divItemenu");c.push({v:a.getAttribute("uname"),m:a.getAttribute("uid")});break;default:if(c=xb(!0),!c)return}a=t("#tblQueue");var b=a.G;a.ca.style.display="block";var d=b.rows.length,e=d;c.forEach(function(g){Ob(b,e,g.v);Jb&&Sb({_type:1,_rowIdx:e,_downinf:{_targetId:g.m}});e++});if(!Jb){var f=function(g){Tb(b,
d+g,function(){g++;g<c.length&&f(g)}).Ra(c[g].m)};f(0)}}
function Ub(a){P();var c=null;c=1===a?document.getElementById("upfolder").files:document.getElementById("upfiles").files;if(0>=c.length)O("noFiles");else{a=t("#tblQueue");var b=a.G;a.ca.style.display="block";var d=b.rows.length;a=d;for(var e=[],f=0;f<c.length;f++){var g="";g=c[f].webkitRelativePath?c[f].webkitRelativePath:c[f].name;e.push({Na:g,_file:c[f],ya:a});Ob(b,a,g);a++}f=0;Lb||(Lb=new Kb(M[0]));var h=Lb;for(f=1;f<M.length;f++)h=h.i(M[f]);var k=function(l){var m=e[l];Vb(h,m.Na,function(n,w,
q){n?Z(b,m.ya,JSON.stringify(n)):Jb?(Sb({_type:2,_rowIdx:m.ya,_upinf:{_fname:w,_file:m._file,_parentId:q}}),l++,l<c.length&&k(l)):Tb(b,d+l,function(){l++;l<c.length?k(l):T(!0)}).Ta(w,m._file,q)})};k(0)}}
function Vb(a,c,b){var d=c.split("/"),e=gb(d.pop()),f=a;if(0==d.length)b(!1,e,f.h.m);else{var g=!1,h=function(k){function l(q){f=q;k++;k<d.length?h(k):b(!1,e,f.h.m)}var m=d[k],n=gb(m);if(g)E.A({Y:n,F:f.h.m,j:function(q,B){q?b(q,e):(B.v=m,l(f.i(B)))}});else{var w=f.l(m);w?l(w):E.l({_fname:n,F:f.h.m,j:function(q,B){q?b(q,e):0==B.length?(g=!0,h(k)):(B[0].v=m,l(f.i(B[0])))}})}};h(0)}};window.addEventListener("load",function(){window.addEventListener("scroll",function(){document.getElementById("divGround").style.top=(document.documentElement.scrollTop||document.body.scrollTop)+"px"});var a=document.getElementById("spanNotify");a.style.display="none";var c=RegExp("android","i").test(navigator.userAgent),b=0,d=document.getElementById("divSet").getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnLogout":a.addEventListener("click",Ma);
break;case "btnCancel":a.addEventListener("click",Ta);break;case "btnOk":a.addEventListener("click",Sa)}d=document.getElementById("divPwd").getElementsByTagName("span");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("tid")){case "spanAddRoot":a.addEventListener("click",Ua);break;case "spanDeleteRoot":a.addEventListener("click",Wa);break;case "spanMoreKey":c?a.addEventListener("click",Za):a.style.display="none";break;case "spanClearKey":c?a.addEventListener("click",Va):a.style.display="none"}d=
document.getElementById("divPwd").getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnCancel":a.addEventListener("click",Ya);break;case "btnOk":a.addEventListener("click",ab);break;case "btnDropDb":a.addEventListener("click",fb)}d=document.getElementById("divHeader").getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnSet":a.addEventListener("click",Na)}document.getElementById("chkAll").addEventListener("click",
rb);d=document.getElementById("divAction").getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnDownfs":a.addEventListener("click",ub);break;case "btnMovefs":a.addEventListener("click",vb);break;case "btnDelfs":a.addEventListener("click",wb);break;case "btnNewFldr":a.addEventListener("click",Bb);break;case "btnUpfs":a.addEventListener("click",Ub);break;case "btnUpfld":a.addEventListener("click",function(){Ub(1)})}a=document.getElementById("tblQueue").getElementsByTagName("th")[0];
a.getElementsByTagName("label")[0].addEventListener("click",Nb);a=document.getElementById("divHistory");a.getElementsByTagName("a")[0].addEventListener("click",Fb);d=a.getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnPHNext":a.addEventListener("click",Hb)}document.getElementById("divItemenu").addEventListener("click",tb);a=document.getElementById("divNewName");a.getElementsByTagName("input")[0].addEventListener("keypress",yb);a.getElementsByTagName("span")[0].addEventListener("click",
zb);a=document.getElementById("divGround").firstElementChild;a.addEventListener("click",X);a.firstElementChild.addEventListener("click",function(e){e.stopPropagation()});a=fa(document.getElementById("spanGroundTitle"),"label");a.addEventListener("click",X);c=document.getElementById("tblFileDetail").getElementsByTagName("tbody")[0].rows;a=c[0];a.cells[0].addEventListener("click",function(){W(1)});a.cells[2].addEventListener("click",function(){W(2)});a.getElementsByTagName("img")[0].addEventListener("load",
Eb);a=a.getElementsByTagName("video")[0];a.addEventListener("canplay",Ib);a.addEventListener("ended",function(){W(2,!0)});d=c[2].getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnDownload":a.addEventListener("click",function(){ub(1)})}d=document.getElementById("tblFolder").getElementsByTagName("input");for(b=0;b<d.length;b++)switch(a=d[b],a.getAttribute("wordid")){case "btnOk":a.addEventListener("click",Ab)}ib()});
