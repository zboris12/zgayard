self.importScripts("vendor/crypto-js.js");function r(d){if(!d)return null;var f=d.charAt(0);if("?"==f||"#"==f)d=d.substring(1);var b={};d.split("&").forEach(function(a){var e=a.indexOf("=");0>e?b[decodeURIComponent(a)]="":b[decodeURIComponent(a.substring(0,e))]=decodeURIComponent(a.substring(e+1))});return b};function t(d){var f=CryptoJS.MD5(d);d=CryptoJS.kdf.OpenSSL.execute(d,8,4,f);d.iv.clamp();d.key.clamp();return d}function u(d){var f=Array(d.sigBytes);d=d.words;for(var b=0,a=0;a<d.length;a++){for(var e=d[a],c=b+4-1;c>=b;c--)c<f.length&&(f[c]=e&255),e>>=8;b+=4;if(b>=f.length)break}return f}
function v(){this.h=0;this.g=null;this.m=function(d,f){this.h=d;f&&f()};this.write=function(d,f){Array.isArray(d)?this.g=this.g?this.g.concat(d):d.concat():(this.g||(this.g=[]),this.g.push(d));f&&f()};this.cancel=function(d){d&&d(!1,!0)};this.l=function(){if(this.g&&0<this.g.length&&(this.g[0]instanceof ArrayBuffer||this.g[0]instanceof Uint8Array)){for(var d=0,f=0;f<this.g.length;f++)d+=this.g[f].byteLength;d=new Uint8Array(d);var b=0;for(f=0;f<this.g.length;++f){var a=this.g[f];a instanceof ArrayBuffer&&
(a=new Uint8Array(a));d.set(a,b);b+=a.byteLength}return d}return this.g};this.i=function(){var d=this.l();d instanceof Uint8Array||(d=new Uint8Array(d));return new Blob([d],{type:"application/octet-binary"})};this.download=function(d){var f=this.i();if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(f,d);else throw Error("Element for download is not specified.");};this.o=function(){return this.h}}
function w(d){this.j=null;if(d._blob)if(d._blob instanceof Blob)this.j=d._blob;else throw Error("blob is not a Blob.");else throw Error("blob must be specified.");this.s=1600;d.H&&(this.s=d.H);this.g=0;this.m=this.i=null;this.B=function(f,b){if(f){if(f>=this.h())throw Error("offset can not be bigger than input size.");this.g=f}this.i=new FileReader;this.i.onload=function(a){a=a.target.result;this.m&&this.m(a,this)}.bind(this);b&&b()};this.o=function(){return this.g};this.h=function(){return this.j.size};
this.u=function(){return this.g>=this.h()};this.l=function(f){if(1!=this.i.readyState){var b=this.g;this.g=f?this.g+f:this.g+this.s;this.i.readAsArrayBuffer(this.j.slice(b,this.g))}};this.T=function(){this.j=this.i=null}}
function x(d){if(!d.X)if(this.getSuperClass&&"Readable"==this.getSuperClass().name)this.super(void 0),this.h=1;else throw Error("writer must be specified in no stream mode.");this.o=this.A=null;this.u=!0;this.g=null;this.l=d.X;this.iv=this.key=null;this.i=0;this.m=null;this.s=this.j=0;this.speed="0B/s";d.$&&(this.u=!1);if(d.W)this.g=d.W;else throw Error("reader must be specified.");if(d.J){var f=null;f="string"==typeof d.J?t(d.J):d.J;this.key=f.key;this.iv=f.iv}else throw Error("keycfg must be specified.");
this.start=function(b){if(b){if(this.u)throw Error("Can NOT set offset for encryption.");this.i=b;b-=b%16+16;0>b&&(b=0)}this.g.m=this.C.bind(this);this.g.B(b,function(){var a=16*Math.ceil((this.g.h()+1)/16);this.h||!this.l?this.B():this.l.m(a,this.B.bind(this))}.bind(this))};this.D=function(){if(Date.now()>this.j){var b=1E3*(this.g.o()-this.s)/(Date.now()-this.j+1E3);if(1024>b)var a="B";else 1048576>b?(a="KB",b=Math.round(b/102.4)/10):1073741824>b?(a="MB",b=Math.round(b/104857.6)/10):(a="GB",b=Math.round(b/
1.073741824E8)/10);var e=b.toString();b=e.indexOf(".");var c=e.split(""),h=[];0<=b?h.push(e.slice(b)):b=c.length;for(e=0;0<b;)3==e++&&(h.unshift(","),e=1),h.unshift(c[--b]);this.speed=h.join("").concat(a)+"/s";this.j=Date.now()+1E3;this.s=this.g.o()}return this.speed};this._read=function(b){1==this.h?this.h=2:3==this.h&&(this.g.u()?this.push(null):this.g.l(b))};this.push=function(b){return this.readable?(b&&!this.L?this.superCall("push",new Uint8Array(b)):this.superCall("push",b),!0):!1};this.B=function(){this.j=
Date.now()+1E3;(this.s=this.i)?this.g.l(16):1==this.h?this.h=3:2==this.h?(this.h=3,this.push([])):this.g.l()};this.C=function(b){try{var a=new CryptoJS.lib.WordArray.init(b);if(!this.m){var e={iv:this.iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7};this.i&&(e.iv=a,a=null);this.m=this.u?CryptoJS.algo.AES.createEncryptor(this.key,e):CryptoJS.algo.AES.createDecryptor(this.key,e)}if(a){var c=u(this.m.process(a));this.g.u()&&(c=c.concat(u(this.m.finalize())));if(this.i<this.g.o()){var h=this.i-(this.g.o()-
b.byteLength);0<h&&(c=c.slice(h))}else c=null;this.h?this.push(c):c?this.l&&this.l.write(c,function(){this.g.u()?this.R():this.A?this.A()?this.g.l():this.l.cancel(function(k,l){this.R(k,l)}.bind(this)):this.g.l()}.bind(this)):this.g.l();c=null}else this.h?2==this.h?(this.h=3,this.push([])):this.h=3:this.g.l()}catch(k){if(this.h)throw k;this.R(k)}};this.R=function(b,a){this.g&&(this.g.T(),this.g=null);this.o&&(b?this.o(b):this.o(!1,a))}};function y(){this.h=!0;this.g=null;this.l=!1;this.s=function(){var d=null;if(this.h)try{d=window.sessionStorage.getItem("login_state")}catch(f){this.h=!1,console.error(f)}return d};this.j=function(d){var f=this.s();return f&&d==f?!0:!1};this.i=function(d,f){if(this.h)try{return window.sessionStorage.setItem(d,f.toString()),!0}catch(b){this.h=!1,console.error(b)}return!1};this.o=function(){if(this.h)try{window.sessionStorage.removeItem("login_state")}catch(d){this.h=!1,console.error(d)}};this.A=function(d){if(window.indexedDB){var f=
window.indexedDB.open("zgayard1946");f.onerror=function(){if(d)d("IndexedDB is not supported in your browser settings.");else throw Error("IndexedDB is not supported in your browser settings.");};f.onupgradeneeded=function(b){b.target.result.createObjectStore("settings",{keyPath:"key"})};f.onsuccess=function(b){var a=b.target.result;b=a.transaction("settings","readwrite");b.oncomplete=function(){a.close();d&&d()};b.objectStore("settings").getAll().onsuccess=function(e){this.g={};e.target.result.forEach(function(c){this.g[c.key]=
c.value}.bind(this));this.l=(e=this.g.drive)&&this.g[e]&&this.g[e].refresh_token?!0:!1}.bind(this)}.bind(this)}else if(d)d("IndexedDB is not supported in your browser settings.");else throw Error("IndexedDB is not supported in your browser settings.");};this.u=function(){var d=this.m();return d&&(d=this.g[d])?d.refresh_token:null};this.B=function(d){if(this.g){var f=this.m();d?(this.g[f]||(this.g[f]={}),this.g[f].refresh_token=d):this.g[f]&&delete this.g[f].refresh_token}};this.m=function(){return this.g&&
this.g.drive?this.g.drive:null}};function z(d,f,b){this.j=b;this.s=f;this.h=null;this.g=d;this.i=function(a){var e="POST",c="https://graph.microsoft.com/v1.0".concat(encodeURI(a.v)),h=new XMLHttpRequest;a&&a.P&&(e=a.P);h.open(e,c,!0);a&&a.F?h.setRequestHeader("Authorization",a.F):a&&a.da?(e="Bearer",a&&a.ea&&(e=a.ea),h.setRequestHeader("Authorization",e+" "+a.da)):h.setRequestHeader("Authorization",this.h);if(a&&a.O)for(var k in a.O)h.setRequestHeader(k,a.O[k]);a&&a.M&&(h.onload=function(l){l=l.target;4==l.readyState&&(401==l.status&&
this.g.l&&!a.ca?this.D(a):a.M({I:l.status,K:l.responseText}))}.bind(this));h.send(a.Z)};this.C=function(a){this.h=a};this.A=function(){return this.h?this.h:""};this.B=function(){var a=this.g.l,e={};var c=r(window.location.search);var h=r(window.location.hash);h&&(c=c?Object.assign(c,h):h);if(c&&c.token_type&&c.access_token)this.m(c.token_type,c.access_token),c&&c.state&&this.g.j(c.state)&&this.g.o();else if(c&&c.code?e.code=c.code:a&&(e.S=this.g.u()),e.code||e.S){if(c&&c.state)if(this.g.j(c.state))this.g.o();
else return;(c=this.l(e))&&c.token_type&&c.access_token&&(this.m(c.token_type,c.access_token),a&&e.code&&c.refresh_token&&this.g.B(c.refresh_token),c.logout&&this.g.i("logout_url",c.logout))}else a&&(e.Y=!0),(c=this.l(e))&&c.url&&(c.state&&(this.g.i("login_state",c.state)||(c.state=A)),c.logout&&this.g.i("logout_url",c.logout),window.location.href=c.url.concat("&state=".concat(encodeURIComponent(c.state))))};this.u=function(a){return new B(a,this)};this.o=function(a){return new C(a,this)};this.D=
function(a){console.log("Retry to send ajax.");a&&(a.ca=!0,this.B(),a.F=this.h,this.i(a))};this.m=function(a,e){this.h=a+" "+e;this.g.i("access_token",this.h)};this.l=function(a){if(!a)throw Error("Options are not specifed when auth onedrive.");var e=new FormData;e.append("drive_type","onedrive");a.clientId&&e.append("client_id",a.clientId);a.ga&&e.append("redirect_uri",a.ga);a.fa&&e.append("client_secret",a.fa);a.code?e.append("code",a.code):a.S?e.append("refresh_token",a.S):a.Y&&e.append("need_code",
a.Y);a=null;var c=new XMLHttpRequest;c.open("POST",this.s,!1);c.withCredentials=!0;c.send(e);if(4==c.readyState)if(200==c.status)a=JSON.parse(c.responseText);else throw Error(c.responseText+" ("+c.status+")");return a}}
function B(d,f){this.u=f;this.g=d;this.j="";this.h=this.l=0;if(!this.g||!this.g.G)throw Error("fnm is not specified.");this.m=function(b,a){this.l=b;b={v:"/me",P:"POST",F:this.g.F,O:{"Content-Type":"application/json;charset=UTF-8","Cache-Control":"no-cache",Pragma:"no-cache"},M:function(h){200<=h.I&&299>=h.I?(this.j=JSON.parse(h.K).uploadUrl,a&&a(h)):(console.error(h),alert(JSON.stringify(h)))}.bind(this)};this.g.V?b.v="/me/drive/items/"+this.g.V+":/":this.g.N?(this.g.N.startsWith("/drive/root:")||
(b.v+="/drive/root:/"),b.v+=this.g.N.concat("/")):b.v+="/drive/root:/";b.v+=this.g.G;b.v+=":/createUploadSession";var e={"@microsoft.graph.conflictBehavior":"replace"},c=this.g.G.lastIndexOf("/");e.name=0<=c?this.g.G.slice(c+1):this.g.G;b.Z=JSON.stringify({item:e});this.u.i(b)};this.write=function(b,a){var e=new Blob([new Uint8Array(b)],{type:"application/octet-binary"}),c="bytes "+this.h+"-";this.h+=e.size;c+=this.h-1+"/"+this.l;var h=0,k=function(){var l=new XMLHttpRequest;l.open("PUT",this.j,!0);
l.setRequestHeader("Content-Range",c);l.onload=function(m){e=b=null;m=m.target;4==m.readyState&&(200<=m.status&&299>=m.status?a&&a(m.responseText):alert(m.responseText+" ("+m.status+")"))}.bind(this);l.onerror=function(){1>h?(h++,setTimeout(function(){k()},500)):e=b=null};l.send(e)}.bind(this);k()};this.cancel=function(b){var a=new XMLHttpRequest;a.open("DELETE",this.j,!0);a.onload=function(e){e=e.target;if(4==e.readyState){var c={I:e.status,K:e.responseText};200<=e.status&&299>=e.status?b&&b(!1,
c):(console.log(e.responseText+" ("+e.status+")"),b&&b(c))}}.bind(this);a.send()};this.o=function(){return this.l}}
function C(d,f){this.A=f;this.L=d;this.url="";this.name=null;this.s=this.i=this.g=this.size=0;this.U=!1;this.D=16E3;d.H&&(this.D=d.H);this.j=0;this.m=null;this.B=function(b,a){if(this.U){this.i&&(this.s=this.i,this.i=0);if(b){if(b>=this.h())throw console.log("offset:"+b+",size:"+this.h()),Error("offset can not be bigger than input size.");this.g=b}else this.g=0;a&&a()}else this.A.i({v:"/me/drive/items/"+this.L.aa,P:"GET",F:this.L.F,M:function(e){this.U=!0;if(200!=e.I)throw Error(e.K+" ("+e.I+")");
e=JSON.parse(e.K);this.size=e.size;if(b){if(b>=this.h())throw Error("offset can not be bigger than input size.");this.g=b}this.url=e["@microsoft.graph.downloadUrl"];this.name=e.name;a&&a()}.bind(this)})};this.o=function(){return this.g};this.h=function(){return this.size};this.u=function(){return this.g>=this.h()};this.l=function(b){b||(b=this.D);this.C(b)};this.T=function(){};this.C=function(b){if(!b||!this.i){if(b)this.i=b;else if(this.i)b=this.i;else throw Error("size must be specified.");if(!this.s){var a=
this.g+b-1,e=function(){var c=new XMLHttpRequest;10<=this.j?(c.open("GET",this.A.j,!0),c.setRequestHeader("Zb-Url",this.url)):c.open("GET",this.url,!0);(0<this.g||a<this.size-1)&&c.setRequestHeader("Range","bytes="+this.g+"-"+a);c.responseType="arraybuffer";c.onload=function(h){if(this.s)this.s=0,this.i&&this.C();else if(this.i=0,h=h.target,4==h.readyState)if(this.j=10>this.j?1:11,200==h.status||206==h.status){var k=parseInt(h.getResponseHeader("content-length"),10);if(k)this.g+=k;else{if(k=h.getResponseHeader("content-range")){var l=
k.indexOf("-");if(0>l)k=0;else{l++;var m=k.indexOf("/",l);k=m<=l?0:parseInt(k.slice(l,m),10)}}else k=0;this.g=k?k+1:a+1}200==h.status&&this.g<this.h()?this.g=this.h():this.g>this.h()&&(this.g=this.h());this.m&&this.m(h.response,this);h.response=null}else throw Error(h.responseText+" ("+h.status+")");}.bind(this);c.onerror=function(){if(0==this.j&&this.A.j)this.j=10,e();else if(1==this.j||11==this.j)this.j++,setTimeout(function(){e()},500)}.bind(this);c.send()}.bind(this);e()}}}}var A="onedrive";var D={};(function(d){d[A]={ia:"Microsoft OneDrive",ba:function(f,b,a){return new z(f,b,a)},ha:function(f){return f&&f.state==A?!0:!1}}})(D);function E(d,f,b){this.g=this.h=null;this.l=d;this.i=1;this.u=f;this.j=b;this.m=function(){var a=new x({$:1==this.i,J:this.l,W:this.h,X:this.g});a.A=function(){var e={_type:1,_wtype:this.i,_speed:a.D(),_pos:this.h.o(),_size:this.h.h()};this.j(e);return this.u()?!1:!0}.bind(this);a.o=function(e,c){var h={_type:2,_wtype:this.i,_size:this.g.o()};e?h._err=e.message||e.ja:c?h._type=3:this.g.i&&(h._blob=this.g.i());this.j(h)}.bind(this);a.start()};this.o=function(a,e){this.i=1;this.h=a.o({aa:e,H:16E5});
this.g=new v;this.m()};this.s=function(a,e,c,h,k,l){c=c.split("/");if(e)for(e=0;e<c.length;e++){var m=e,p=this.l;var q=CryptoJS.enc.Utf8.parse(c[e]);var n=p;"string"==typeof p&&(n=t(p));if(!(n&&n.iv&&n.key))throw Error("Need iv and key. They can be generated by CryptoJS.kdf.OpenSSL.execute from password and salt.");p={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7};Object.assign(p,n);n=CryptoJS.algo.AES.createEncryptor(p.key,p);q=n.process(q);q.concat(n.finalize());q.clamp();q=q.toString(CryptoJS.enc.Base64url);
c[m]=q}this.i=2;this.h=new w({_blob:h,H:16E5});h={G:c[0],V:k};1<c.length&&(h.G=c.join("/"),h.N=l);this.g=a.u(h);this.m()}};window=self;self.g=!1;function F(d,f){return new E(d,function(){return self.g},function(b){2==b._type&&(b._token=f.A());self.postMessage(b)})}
function G(d){var f=d._type,b=d._cominf,a={iv:CryptoJS.enc.Base64url.parse(b._iv),key:CryptoJS.enc.Base64url.parse(b._key)};self.postMessage({_type:0,_wtype:f,_size:0});var e=new y;e.A(function(c){c&&console.error("IndexedDB is not supported in your browser settings.");if(c=D[b._drvnm])switch(c=c.ba(e,"https://zgayard.f5.si/grantauth.php","https://zgayard.f5.si/relay.php"),c.C(b._token),f){case 1:F(a,c).o(c,d._downinf._targetId);break;case 2:var h=d._upinf;F(a,c).s(c,b._encfname,h._fpath,h._file,
h._baseId,h._basePath)}else self.postMessage({_type:2,_wtype:f,_size:0,_err:"Drive's name is invalid."})})}self.addEventListener("message",function(d){d=d.data;switch(d._type){case 1:case 2:G(d);break;default:self.g=!0}});
